<pre><font style="font-family: Consolas, monospace; font-size: 11,75pt; line-height: 19px;"><font style="color:#0000ff;">/*</font><font style="color:#0000ff;">
   CONTROL BOX arduino based
   Nextion Display </font><font style="color:#0000ff;">4.3</font><font style="color:#0000ff;">"</font><font style="color:#0000ff;">
*/</font><font style="color:#800080;">

#include</font><font style="color:#000000;"> </font><font style="color:#800080;">&lt;</font><font style="color:#800080;">Nextion.h</font><font style="color:#800080;">&gt;</font><font style="color:#800080;">
#include</font><font style="color:#000000;"> </font><font style="color:#800080;">&lt;</font><font style="color:#800080;">EEPROM</font><font style="color:#800080;">.h</font><font style="color:#800080;">&gt;</font><font style="color:#800080;">
#include</font><font style="color:#000000;"> </font><font style="color:#800080;">"declare.h"</font><font style="color:#000000;"> </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> variabili e costanti di ambiente</font><font style="color:#800080;">
#include</font><font style="color:#000000;"> </font><font style="color:#800080;">"ext_func.h"</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">funzioni da richiamare esternamente</font><font style="color:#800080;">
#include</font><font style="color:#000000;"> </font><font style="color:#800080;">"callback.h"</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> funzioni callback di Nextion display</font><font style="color:#0000ff;">

/*</font><font style="color:#0000ff;">
   Register a button object to the touch event list.</font><font style="color:#0000ff;">
*/</font><font style="color:#000000;">
NexTouch </font><font style="color:#800000;">*</font><font style="color:#000000;">nex_listen_list</font><font style="color:#800000;">[]</font><font style="color:#000000;"> </font><font style="color:#800000;">=
{</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_CCW</font><font style="color:#800000;">,</font><font style="color:#000000;">        </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">evento pressione touch ccw</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_CW</font><font style="color:#800000;">,</font><font style="color:#000000;">         </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">evento pressione touch cw</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_UP</font><font style="color:#800000;">,</font><font style="color:#000000;">         </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">evento pressione touch up</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_DOWN</font><font style="color:#800000;">,</font><font style="color:#000000;">       </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">evento pressione touch DOWN</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_AZIMUT_ENT</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM0</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM1</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM2</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM3</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM4</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM5</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM6</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM7</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_MEM_WEST</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_MEM_EST</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_MEM_SUD</font><font style="color:#800000;">,</font><font style="color:#000000;">
  </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_MEM_NORD</font><font style="color:#800000;">,</font><font style="color:#000000;">
  NULL</font><font style="color:#800000;">
};</font><font style="color:#008000;">

void</font><font style="color:#000000;"> </font><font style="color:#00008b;">setup</font><font style="color:#800000;">(</font><font style="color:#008000;">void</font><font style="color:#800000;">)
{</font><font style="color:#000000;">
  </font><font style="color:#008000;">unsigned</font><font style="color:#000000;"> </font><font style="color:#008000;">long</font><font style="color:#000000;"> previousMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#808000;">0</font><font style="color:#800000;">;</font><font style="color:#000000;">
  VAR_AZIMUT_LAST_TARGET </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#800000;">((</font><font style="color:#00008b;">EEPROM</font><font style="color:#000000;">.</font><font style="color:#00008b;">read</font><font style="color:#800000;">(</font><font style="color:#808000;">0</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">*</font><font style="color:#000000;"> </font><font style="color:#808000;">4</font><font style="color:#800000;">));</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> RECUPERA INFO SU ULTIMO TARGET RICHIESTO</font><font style="color:#000000;">
  
  </font><font style="color:#008000;">for</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#008000;">int</font><font style="color:#000000;"> X </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#808000;">8</font><font style="color:#800000;">;</font><font style="color:#000000;"> X </font><font style="color:#800000;">&lt;=</font><font style="color:#000000;"> </font><font style="color:#808000;">11</font><font style="color:#800000;">;</font><font style="color:#000000;"> X</font><font style="color:#800000;">++)</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#000000;">
    </font><font style="color:#00008b;">pinMode</font><font style="color:#800000;">(</font><font style="color:#000000;"> X</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#d76b00;">OUTPUT</font><font style="color:#000000;"> </font><font style="color:#800000;">);</font><font style="color:#000000;">
    </font><font style="color:#00008b;">digitalWrite</font><font style="color:#800000;">(</font><font style="color:#000000;"> X</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#d76b00;">LOW</font><font style="color:#000000;"> </font><font style="color:#800000;">);</font><font style="color:#000000;">
  </font><font style="color:#800000;">}</font><font style="color:#000000;">
  nexInit</font><font style="color:#800000;">();</font><font style="color:#000000;">
  </font><font style="color:#0000ff;">/*</font><font style="color:#0000ff;"> Register the pop and push event callback function of the current button component. </font><font style="color:#0000ff;">*/</font><font style="color:#000000;">
  TOU_CCW.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_CCWPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_CCW</font><font style="color:#800000;">);</font><font style="color:#000000;">     </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> TOUCH AREA PER AZIONAMENTO MANUALE DEL ROTORE</font><font style="color:#000000;">
  TOU_CCW.attachPush</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_CCWPushCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_CCW</font><font style="color:#800000;">);</font><font style="color:#000000;">   </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> TOUCH AREA PER AZIONAMENTO MANUALE DEL ROTORE</font><font style="color:#000000;">
  TOU_CW.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_CWPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_CW</font><font style="color:#800000;">);</font><font style="color:#000000;">        </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> TOUCH AREA PER AZIONAMENTO MANUALE DEL ROTORE</font><font style="color:#000000;">
  TOU_CW.attachPush</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_CWPushCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_CW</font><font style="color:#800000;">);</font><font style="color:#000000;">      </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> TOUCH AREA PER AZIONAMENTO MANUALE DEL ROTORE</font><font style="color:#000000;">
  TOU_UP.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_UPPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_UP</font><font style="color:#800000;">);</font><font style="color:#000000;">        </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> TOUCH AREA PER AZIONAMENTO MANUALE DEL ROTORE</font><font style="color:#000000;">
  TOU_UP.attachPush</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_UPPushCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_UP</font><font style="color:#800000;">);</font><font style="color:#000000;">      </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> TOUCH AREA PER AZIONAMENTO MANUALE DEL ROTORE</font><font style="color:#000000;">
  TOU_DOWN.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_DOWNPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_DOWN</font><font style="color:#800000;">);</font><font style="color:#000000;">  </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> TOUCH AREA PER AZIONAMENTO MANUALE DEL ROTORE</font><font style="color:#000000;">
  TOU_DOWN.attachPush</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_DOWNPushCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_DOWN</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> TOUCH AREA PER AZIONAMENTO MANUALE DEL ROTORE</font><font style="color:#000000;">
  BTN_AZIMUT_ENT.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_AZIMUT_ENTPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_AZIMUT_ENT</font><font style="color:#800000;">);</font><font style="color:#000000;">

  BTN_MEM1.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_MEM1PopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM1</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE</font><font style="color:#000000;">
  BTN_MEM2.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_MEM2PopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM2</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE</font><font style="color:#000000;">
  BTN_MEM3.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_MEM3PopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM3</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE</font><font style="color:#000000;">
  BTN_MEM4.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_MEM4PopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM4</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE</font><font style="color:#000000;">
  BTN_MEM5.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_MEM5PopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM5</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE</font><font style="color:#000000;">
  BTN_MEM6.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_MEM6PopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM6</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE</font><font style="color:#000000;">
  BTN_MEM7.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_MEM7PopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM7</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE</font><font style="color:#000000;">
  BTN_MEM0.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">BTN_MEM0PopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">BTN_MEM0</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE</font><font style="color:#000000;">

  TOU_MEM_WEST.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_MEM_WESTPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_MEM_WEST</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE OVEST</font><font style="color:#000000;">
  TOU_MEM_EST.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_MEM_ESTPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_MEM_EST</font><font style="color:#800000;">);</font><font style="color:#000000;">   </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE EST</font><font style="color:#000000;">
  TOU_MEM_SUD.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_MEM_SUDPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_MEM_SUD</font><font style="color:#800000;">);</font><font style="color:#000000;">   </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE SUN</font><font style="color:#000000;">
  TOU_MEM_NORD.attachPop</font><font style="color:#800000;">(</font><font style="color:#000000;">TOU_MEM_NORDPopCallback</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#800000;">&amp;</font><font style="color:#000000;">TOU_MEM_NORD</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> BUTTON PER POSIZIONI PREIMPOSTATE NORD</font><font style="color:#000000;">

  dbSerialPrintln</font><font style="color:#800000;">(</font><font style="color:#800080;">"</font><font style="color:#800080;">setup</font><font style="color:#800080;"> done"</font><font style="color:#800000;">);</font><font style="color:#000000;">

  </font><font style="color:#00008b;">delay</font><font style="color:#800000;">(</font><font style="color:#808000;">1000</font><font style="color:#800000;">);</font><font style="color:#000000;">

  </font><font style="color:#008000;">int</font><font style="color:#000000;"> x </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#808000;">20</font><font style="color:#800000;">;</font><font style="color:#000000;">
  </font><font style="color:#008000;">for</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#008000;">int</font><font style="color:#000000;"> a </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#808000;">0</font><font style="color:#800000;">;</font><font style="color:#000000;"> a </font><font style="color:#800000;">&gt;=</font><font style="color:#000000;"> </font><font style="color:#800000;">-</font><font style="color:#808000;">1</font><font style="color:#800000;">;</font><font style="color:#000000;"> a </font><font style="color:#800000;">=</font><font style="color:#000000;"> a </font><font style="color:#800000;">+</font><font style="color:#000000;"> x </font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#000000;">  </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">DEMO gauge</font><font style="color:#000000;">
    </font><font style="color:#008000;">int</font><font style="color:#000000;"> b </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;">a </font><font style="color:#800000;">*</font><font style="color:#000000;"> </font><font style="color:#808000;">2</font><font style="color:#800000;">);</font><font style="color:#000000;">
    GAU_ELEVAZ.setValue</font><font style="color:#800000;">(</font><font style="color:#000000;"> a </font><font style="color:#800000;">);</font><font style="color:#000000;">
    itoa</font><font style="color:#800000;">(</font><font style="color:#000000;">a</font><font style="color:#800000;">,</font><font style="color:#000000;"> BUFFER_EL</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#808000;">10</font><font style="color:#800000;">);</font><font style="color:#000000;">
    TXT_ELEVAZ.setText</font><font style="color:#800000;">(</font><font style="color:#000000;"> BUFFER_EL </font><font style="color:#800000;">);</font><font style="color:#000000;">
    GAU_AZIMUT.setValue</font><font style="color:#800000;">(</font><font style="color:#000000;"> b </font><font style="color:#800000;">);</font><font style="color:#000000;">
    itoa</font><font style="color:#800000;">(</font><font style="color:#000000;">b</font><font style="color:#800000;">,</font><font style="color:#000000;"> BUFFER_AZ</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#808000;">10</font><font style="color:#800000;">);</font><font style="color:#000000;">
    TXT_AZIMUT.setText</font><font style="color:#800000;">(</font><font style="color:#000000;"> BUFFER_AZ </font><font style="color:#800000;">);</font><font style="color:#000000;">
    </font><font style="color:#008000;">if</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;">a </font><font style="color:#800000;">==</font><font style="color:#000000;"> </font><font style="color:#808000;">180</font><font style="color:#800000;">)</font><font style="color:#000000;"> x </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#800000;">-</font><font style="color:#000000;">x</font><font style="color:#800000;">;</font><font style="color:#000000;">
   </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">delay</font><font style="color:#0000ff;">(</font><font style="color:#0000ff;">1000</font><font style="color:#0000ff;">);</font><font style="color:#000000;">
  </font><font style="color:#800000;">}</font><font style="color:#000000;">

  azimut_current</font><font style="color:#800000;">();</font><font style="color:#000000;">
  elevaz_current</font><font style="color:#800000;">();
}</font><font style="color:#008000;">

void</font><font style="color:#000000;"> loop</font><font style="color:#800000;">(</font><font style="color:#008000;">void</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#000000;">

  </font><font style="color:#008000;">int</font><font style="color:#000000;"> X </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">map</font><font style="color:#800000;">(</font><font style="color:#00008b;">analogRead</font><font style="color:#800000;">(</font><font style="color:#000000;">SENS_POT_AZIMUT</font><font style="color:#800000;">),</font><font style="color:#000000;"> </font><font style="color:#808000;">0</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#808000;">1023</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#808000;">0</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#808000;">450</font><font style="color:#800000;">);</font><font style="color:#000000;">
  </font><font style="color:#008000;">int</font><font style="color:#000000;"> Y </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">map</font><font style="color:#800000;">(</font><font style="color:#00008b;">analogRead</font><font style="color:#800000;">(</font><font style="color:#000000;">SENS_POT_ELEVAZ</font><font style="color:#800000;">),</font><font style="color:#000000;"> </font><font style="color:#808000;">0</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#808000;">1023</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#808000;">0</font><font style="color:#800000;">,</font><font style="color:#000000;"> </font><font style="color:#808000;">180</font><font style="color:#800000;">);</font><font style="color:#000000;">
  </font><font style="color:#008000;">int</font><font style="color:#000000;"> AZ_CURR_DIFF </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#00008b;">max</font><font style="color:#800000;">(</font><font style="color:#000000;">X</font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_CURRENT</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">-</font><font style="color:#000000;"> </font><font style="color:#00008b;">min</font><font style="color:#800000;">(</font><font style="color:#000000;">X</font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_CURRENT</font><font style="color:#800000;">));</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">CALCOLO LA DIFFERENZA TRA AZIMUT_CURRENT E VALORE ATTUALE</font><font style="color:#000000;">
  </font><font style="color:#008000;">int</font><font style="color:#000000;"> EL_CURR_DIFF </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#00008b;">max</font><font style="color:#800000;">(</font><font style="color:#000000;">Y</font><font style="color:#800000;">,</font><font style="color:#000000;"> ELEVAZ_CURRENT</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">-</font><font style="color:#000000;"> </font><font style="color:#00008b;">min</font><font style="color:#800000;">(</font><font style="color:#000000;">Y</font><font style="color:#800000;">,</font><font style="color:#000000;"> ELEVAZ_CURRENT</font><font style="color:#800000;">));</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">CALCOLO LA DIFFERENZA TRA VAR_ELEVAZT_CURRENT E VALORE ATTUALE</font><font style="color:#000000;">
  </font><font style="color:#008000;">unsigned</font><font style="color:#000000;"> </font><font style="color:#008000;">long</font><font style="color:#000000;"> currentMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">millis</font><font style="color:#800000;">();</font><font style="color:#000000;">
  
  nexLoop</font><font style="color:#800000;">(</font><font style="color:#000000;">nex_listen_list</font><font style="color:#800000;">);</font><font style="color:#000000;">
  
  </font><font style="color:#008000;">if</font><font style="color:#000000;"> </font><font style="color:#800000;">((</font><font style="color:#000000;">AZIMUT_ROTAZIONE </font><font style="color:#800000;">==</font><font style="color:#000000;"> </font><font style="color:#800080;">"CCW"</font><font style="color:#800000;">))</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#000000;">
    </font><font style="color:#008000;">unsigned</font><font style="color:#000000;"> </font><font style="color:#008000;">long</font><font style="color:#000000;"> previousMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#808000;">0</font><font style="color:#800000;">;</font><font style="color:#000000;">
    rotazione_CCW</font><font style="color:#800000;">();</font><font style="color:#000000;">
    AZ_MAX </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">max</font><font style="color:#800000;">(</font><font style="color:#000000;">AZIMUT_CURRENT </font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_TARGET</font><font style="color:#800000;">);</font><font style="color:#000000;">
    AZ_MIN </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">min</font><font style="color:#800000;">(</font><font style="color:#000000;">AZIMUT_CURRENT </font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_TARGET</font><font style="color:#800000;">);</font><font style="color:#000000;">
    </font><font style="color:#008000;">while</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;"> AZ_MAX </font><font style="color:#800000;">-</font><font style="color:#000000;"> AZ_MIN </font><font style="color:#800000;">&gt;</font><font style="color:#000000;"> </font><font style="color:#808000;">1</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#000000;">
      currentMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">millis</font><font style="color:#800000;">();</font><font style="color:#000000;">
      </font><font style="color:#008000;">if</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;">currentMillis </font><font style="color:#800000;">-</font><font style="color:#000000;"> previousMillis </font><font style="color:#800000;">&gt;</font><font style="color:#000000;"> </font><font style="color:#808000;">500</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> aggiorna la posizione ogni </font><font style="color:#0000ff;">750</font><font style="color:#0000ff;">ms</font><font style="color:#000000;">
        dbSerialPrintln</font><font style="color:#800000;">(</font><font style="color:#800080;">"ogni secondo</font><font style="color:#800080;">,</font><font style="color:#800080;"> richiamata rotazione CCW"</font><font style="color:#800000;">);</font><font style="color:#000000;">
        azimut_current</font><font style="color:#800000;">();</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> invia valori al display e Leggere il valore del potenziometro</font><font style="color:#000000;">
        previousMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> currentMillis</font><font style="color:#800000;">;</font><font style="color:#000000;">
      </font><font style="color:#800000;">}</font><font style="color:#000000;">
      AZ_MAX </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">max</font><font style="color:#800000;">(</font><font style="color:#000000;">AZIMUT_CURRENT </font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_TARGET</font><font style="color:#800000;">);</font><font style="color:#000000;">
      AZ_MIN </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">min</font><font style="color:#800000;">(</font><font style="color:#000000;">AZIMUT_CURRENT </font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_TARGET</font><font style="color:#800000;">);</font><font style="color:#000000;">
    </font><font style="color:#800000;">}</font><font style="color:#000000;">
    azimut_stop</font><font style="color:#800000;">();</font><font style="color:#000000;">
    AZIMUT_ROTAZIONE </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#800080;">"STOP"</font><font style="color:#800000;">;</font><font style="color:#000000;">
  </font><font style="color:#800000;">}</font><font style="color:#000000;">
  
  </font><font style="color:#008000;">else</font><font style="color:#000000;"> </font><font style="color:#008000;">if</font><font style="color:#000000;"> </font><font style="color:#800000;">((</font><font style="color:#000000;">AZIMUT_ROTAZIONE  </font><font style="color:#800000;">==</font><font style="color:#000000;"> </font><font style="color:#800080;">"CW"</font><font style="color:#800000;">))</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#000000;">
    </font><font style="color:#008000;">unsigned</font><font style="color:#000000;"> </font><font style="color:#008000;">long</font><font style="color:#000000;"> previousMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#808000;">0</font><font style="color:#800000;">;</font><font style="color:#000000;">
    dbSerialPrintln</font><font style="color:#800000;">(</font><font style="color:#800080;">"Ciclo IF richiamato da rotazione</font><font style="color:#800080;">(),</font><font style="color:#800080;"> richiamata rotazione CW"</font><font style="color:#800000;">);</font><font style="color:#000000;">
    rotazione_CW</font><font style="color:#800000;">();</font><font style="color:#000000;">
    AZ_MAX </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">max</font><font style="color:#800000;">(</font><font style="color:#000000;">AZIMUT_CURRENT </font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_TARGET</font><font style="color:#800000;">);</font><font style="color:#000000;">
    AZ_MIN </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">min</font><font style="color:#800000;">(</font><font style="color:#000000;">AZIMUT_CURRENT </font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_TARGET</font><font style="color:#800000;">);</font><font style="color:#000000;">
    </font><font style="color:#008000;">while</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;"> AZ_MAX </font><font style="color:#800000;">-</font><font style="color:#000000;"> AZ_MIN </font><font style="color:#800000;">&gt;</font><font style="color:#000000;"> </font><font style="color:#808000;">1</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#000000;">
      currentMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">millis</font><font style="color:#800000;">();</font><font style="color:#000000;">
      </font><font style="color:#008000;">if</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;">currentMillis </font><font style="color:#800000;">-</font><font style="color:#000000;"> previousMillis </font><font style="color:#800000;">&gt;</font><font style="color:#000000;"> </font><font style="color:#808000;">500</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> aggiorna la posizione ogni </font><font style="color:#0000ff;">750</font><font style="color:#0000ff;">ms</font><font style="color:#000000;">
        dbSerialPrintln</font><font style="color:#800000;">(</font><font style="color:#800080;">"ogni secondo</font><font style="color:#800080;">,</font><font style="color:#800080;"> richiamata rotazione CW"</font><font style="color:#800000;">);</font><font style="color:#000000;">
        azimut_current</font><font style="color:#800000;">();</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> invia valori al display e Leggere il valore del potenziometro</font><font style="color:#000000;">
        previousMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> currentMillis</font><font style="color:#800000;">;</font><font style="color:#000000;">
      </font><font style="color:#800000;">}</font><font style="color:#000000;">
      AZ_MAX </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">max</font><font style="color:#800000;">(</font><font style="color:#000000;">AZIMUT_CURRENT </font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_TARGET</font><font style="color:#800000;">);</font><font style="color:#000000;">
      AZ_MIN </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#00008b;">min</font><font style="color:#800000;">(</font><font style="color:#000000;">AZIMUT_CURRENT </font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_TARGET</font><font style="color:#800000;">);</font><font style="color:#000000;">
    </font><font style="color:#800000;">}</font><font style="color:#000000;">
    azimut_stop</font><font style="color:#800000;">();</font><font style="color:#000000;">
    AZIMUT_ROTAZIONE </font><font style="color:#800000;">=</font><font style="color:#000000;"> </font><font style="color:#800080;">"STOP"</font><font style="color:#800000;">;</font><font style="color:#000000;">
  </font><font style="color:#800000;">}</font><font style="color:#000000;">

 
  </font><font style="color:#008000;">if</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;">currentMillis </font><font style="color:#800000;">-</font><font style="color:#000000;"> previousMillis </font><font style="color:#800000;">&gt;=</font><font style="color:#000000;"> </font><font style="color:#808000;">500</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#800000;">{</font><font style="color:#000000;">
    previousMillis </font><font style="color:#800000;">=</font><font style="color:#000000;"> currentMillis</font><font style="color:#800000;">;</font><font style="color:#000000;">
    </font><font style="color:#008000;">if</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;">AZ_CURR_DIFF </font><font style="color:#800000;">&gt;</font><font style="color:#000000;"> </font><font style="color:#808000;">2</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">Aggiorno valore display solo se differenza maggiore di </font><font style="color:#0000ff;">2</font><font style="color:#000000;">
    </font><font style="color:#800000;">{</font><font style="color:#000000;">
      azimut_current</font><font style="color:#800000;">();</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">Calcolo e visualizzazione azimut corrente su display</font><font style="color:#000000;">
      </font><font style="color:#00008b;">EEPROM</font><font style="color:#000000;">.</font><font style="color:#00008b;">update</font><font style="color:#800000;">(</font><font style="color:#000000;">L_A</font><font style="color:#800000;">,</font><font style="color:#000000;"> AZIMUT_CURRENT </font><font style="color:#800000;">/</font><font style="color:#000000;"> </font><font style="color:#808000;">4</font><font style="color:#800000;">);</font><font style="color:#000000;">
    </font><font style="color:#800000;">}</font><font style="color:#000000;">
    </font><font style="color:#008000;">if</font><font style="color:#000000;"> </font><font style="color:#800000;">(</font><font style="color:#000000;">EL_CURR_DIFF </font><font style="color:#800000;">&gt;</font><font style="color:#000000;"> </font><font style="color:#808000;">2</font><font style="color:#800000;">)</font><font style="color:#000000;"> </font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">Aggiorno valore display solo se differenza maggiore di </font><font style="color:#0000ff;">2</font><font style="color:#000000;">
    </font><font style="color:#800000;">{</font><font style="color:#000000;">
      elevaz_current</font><font style="color:#800000;">();</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;">Calcolo e visualizzazione ELEVAZ corrente su display</font><font style="color:#000000;">
      </font><font style="color:#00008b;">EEPROM</font><font style="color:#000000;">.</font><font style="color:#00008b;">update</font><font style="color:#800000;">(</font><font style="color:#000000;">L_E</font><font style="color:#800000;">,</font><font style="color:#000000;"> ELEVAZ_CURRENT</font><font style="color:#800000;">);</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">//</font><font style="color:#0000ff;"> NON Ã¨ NECESSARIO DIVIDERE IL VALORE PER </font><font style="color:#0000ff;">4</font><font style="color:#0000ff;"> POICHE' ELEVAZ MAX </font><font style="color:#0000ff;">=</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">180</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">(&lt;</font><font style="color:#0000ff;"> </font><font style="color:#0000ff;">255</font><font style="color:#0000ff;">)</font><font style="color:#000000;">
    </font><font style="color:#800000;">}</font><font style="color:#000000;">
  </font><font style="color:#800000;">}
}</font></font></pre>